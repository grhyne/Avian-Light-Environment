---
title: "Avian Light Environment Code"
output: html_document
---


## Introduction

Install the packages needed, mainly 'tidyr' for easy coding

```{r}
library('tidyr')
library('ggplot2')
```

Here we are going to import the raw light .csv data. INSERT FILE HERE

```{r}
spName1 <- "Hylopezus macularius"
rawData <- as.data.frame(read.csv("./Species_Data/HYMA_geo.csv", header=TRUE))

#Insert date banded and date recaptured in "YYYY-MM-DD" format
bandDate1 <- "2018-07-24"
recapDate1 <- "2019-06-03"

#Second species to compare
spName2 <- "Myrmothera campanisona"
rawData2 <- as.data.frame(read.csv("./Species_Data/MYCA_geo.csv", header = TRUE))

#Band dates of second species
bandDate2 <- "2018-8-19"
recapDate2 <- "2019-5-31"
```

Now to format the data organization. Because date and time are compiled together, we want them to be separate columns. We also want to cut out the lag time before deployment, so you will have to input an exact banding time.

```{r}
sepRawData<-rawData %>%
tidyr::separate(DD.MM.YYYY.HH.MM.SS, into = c("date", "time"), sep = " ")
#Converting 'date' column as sequential dates, renaming light column
sepRawData$date <- as.Date(sepRawData$date, "%d/%m/%Y")

dateData <- sepRawData[(sepRawData$date >= bandDate1) & (sepRawData$date <= recapDate1) ,]

```


Remove all night-time light recordings (> 1.136 lumens)

```{r}
daylightData <- dplyr::filter(dateData, light.lux. > 1.136 & light.lux. < 1000)
  
```

Finalize our data to have daily mean, max, and min

```{r}

finalData <- daylightData %>% 
  dplyr::group_by(date) %>%
  dplyr::summarise(mean = mean(light.lux.), max = max(light.lux.),min = min(light.lux.))
  
View(finalData)
```

Plot the average light

```{r}
plot(finalData$date, finalData$mean,
     main = spName1,
     ylab = "Daily mean light (lux)",
     xlab = "Month",
     type = "l")
```

Now we will repeat this process for the second species
```{r}
sepRawData2<-rawData2 %>%
tidyr::separate(DD.MM.YYYY.HH.MM.SS, into = c("date", "time"), sep = " ")
#Converting 'date' column as sequential dates, renaming light column
sepRawData2$date <- as.Date(sepRawData2$date, "%d/%m/%Y")

dateData2 <- sepRawData2[(sepRawData2$date >= bandDate2) & (sepRawData2$date <= recapDate2) ,]

daylightData2 <- dplyr::filter(dateData2, light.lux. > 1.136 & light.lux. < 1000)

finalData2 <- daylightData2 %>% 
  dplyr::group_by(date) %>%
  dplyr::summarise(mean = mean(light.lux.), max = max(light.lux.),min = min(light.lux.))

View(finalData2)

plot(finalData2$date, finalData2$mean,
     main = spName2,
     ylab = "Daily mean light (lux)",
     xlab = "Month",
     type = "l")

```


Compare the two
```{r}

ggplot() + 
  geom_line(data = finalData, aes(x = date, y = mean, color = spName1)) + geom_line(data = finalData2, aes(x = date, y = mean, color = spName2)) + theme(legend.position="bottom")
 
```




Basic statistics of both species
```{r}
summary(finalData$mean)

summary(finalData2$mean)

```


```{r}
months1 <- finalData %>%
  dplyr::mutate(month = format(date, "%m"))

boxplot(mean~month, data = months1, main = spName1, xlab = "Month", ylab = "Avg. Light (lux)", outline = FALSE)  

```

```{r}
months2 <- finalData2 %>%
  dplyr::mutate(month = format(date, "%m"))

boxplot(mean~month, data = months2, main = spName2, xlab = "Month", ylab = "Avg. Light (lux)", outline = FALSE)  

```



