---
title: "Visualizing Avian Light Environments"
author: "Garrett Rhyne"
output: pdf_document
date: "December, 2020"
---
##Introduction
Understanding the ecology and environmental interactions of bird species allows researchers to implement proper conservation plans and predict behavioral and population responses to changes in habitat structure and composition over time (Fischer and Lindenmayer, 2007). Sunlight is an important environmental factor that dictates ecosystems. Although it has been studied heavily in its relationship with plants in relationship to habitat structure, there are knowledge gaps in how sunlight directly affects the ecology and behavior of bird species. 

Advances in animal tracking technologies now allow researchers to collect spatial and temporal avian movement data to better understand . Light-level geolocators are commonly used geotrackers that are fitted onto songbirds to gather this information and are readily available to deploy on small birds (< 20g) unlike traditional GPS units (McKinnon and Love, 2018). Geolocators record light intensity in lumens (lm) from a light sensor situated on the back or rump of the bird throughout each day, typically at 5 to 10-minute intervals. This is accomplished by analyzing raw light data to generate predictive geographic areas based on daylength (latitude) and sunrise / twighlight (longitude). Geolocators on birds occupying open habitats result in tight, accurate data due to high-quality light readings, whereas birds in dense, shaded habitats may result in broader, less defined predictive regions. Data is stored in the unit memory, therefore tagged individuals must be recaptured in order to remove the geolocator and download the raw light data.
Most, if not all, geolocator studies seek to determine breeding or nonbreeding locations of migratory species (CITE). This means that large quantities of light data have been collected for the sole purpose of geolocation, creating a binary set of data that only values two nodes of information each day: sunrise and sunset. These large datasets could instead offer in-depth interpretations of behavioral, seasonal, and ecological traits that are otherwise difficult to monitor. Shifts in light readings of low-light environment birds throughout a tracking period might indicate changes in activity and behavior due to utilizing different habitat strata, encountering canopy openings more frequently, or other possible reasons. A recent study found how light environments in Amazonian birds were correlated to foraging niche partitioning and eye diameter, demonstrating the usefulness and importance of examining light environments (Ausprey, Newell, and Robinson 2020). Although fine-scale analyses of raw light data can be overtly subjective, possible information that could be concluded include differences in habitat structure usage, reproductive timing, responsive strategies to seasonal and environmental influxes. 


##Methods

Install the packages needed, mainly 'tidyr' for easy coding

```{r}
# install.packages('tidyr')
library('tidyr')

#install.packages('ggplot2')
library('ggplot2')

```

Here we are going to import the raw light .csv data. INSERT FILE HERE

```{r}
spName1 <- "Sclerurus mexicanus"
rawData <- as.data.frame(read.csv("./Species_Data/SCME_geo.csv", header=TRUE))

#Insert date banded and date recaptured in "YYYY-MM-DD" format
bandDate1 <- "2018-07-05"
recapDate1 <- "2019-06-25"

#Second species to compare
spName2 <- "Hylopezus macularius"
rawData2 <- as.data.frame(read.csv("./Species_Data/HYMA_geo.csv", header = TRUE))

#Band dates of second species
bandDate2 <- "2018-07-24"
recapDate2 <- "2019-06-03"
```

Now to format the data organization. Because date and time are compiled together, we want them to be separate columns. We also want to cut out the lag time before deployment, so you will have to input an exact banding time.

```{r}
sepRawData<-rawData %>%
tidyr::separate(DD.MM.YYYY.HH.MM.SS, into = c("date", "time"), sep = " ")
#Converting 'date' column as sequential dates, renaming light column
sepRawData$date <- as.Date(sepRawData$date, "%d/%m/%Y")

dateData <- sepRawData[(sepRawData$date >= bandDate1) & (sepRawData$date <= recapDate1) ,]

```


Remove all night-time light recordings (> 1.136 lumens)

```{r}

daylightData <- dplyr::filter(dateData, light.lux. > 1.136 & light.lux. < 1000)
  
```

Finalize our data to have daily mean, max, and min

```{r}

finalData <- daylightData %>% 
  dplyr::group_by(date) %>%
  dplyr::summarise(mean = mean(light.lux.), max = max(light.lux.),min = min(light.lux.))
  
```

```{r}



```

Plot the average light

```{r}
plot(finalData$date, finalData$mean,
     main = spName1,
     ylab = "Daily mean light (lux)",
     xlab = "Month",
     type = "l")
```

Now we will repeat this process for the second species
```{r}
sepRawData2<-rawData2 %>%
tidyr::separate(DD.MM.YYYY.HH.MM.SS, into = c("date", "time"), sep = " ")
#Converting 'date' column as sequential dates, renaming light column
sepRawData2$date <- as.Date(sepRawData2$date, "%d/%m/%Y")

dateData2 <- sepRawData2[(sepRawData2$date >= bandDate2) & (sepRawData2$date <= recapDate2) ,]

daylightData2 <- dplyr::filter(dateData2, light.lux. > 1.136 & light.lux. < 1000)

finalData2 <- daylightData2 %>% 
  dplyr::group_by(date) %>%
  dplyr::summarise(mean = mean(light.lux.), max = max(light.lux.),min = min(light.lux.))

head(finalData2)

plot(finalData2$date, finalData2$mean,
     main = spName2,
     ylab = "Daily mean light (lux)",
     xlab = "Month",
     type = "l")

```


Compare the two
```{r}

ggplot() + 
  geom_line(data = finalData, aes(x = date, y = mean, color = spName1)) + geom_line(data = finalData2, aes(x = date, y = mean, color = spName2)) + theme(legend.position="bottom")
 
```





```{r}

months1 <- finalData %>%
  dplyr::mutate(month = format(date, "%m"))

boxplot(mean~month, data = months1, main = spName1, xlab = "Month", ylab = "Avg. Light (lux)", outline = FALSE)  

```

```{r}
months2 <- finalData2 %>%
  dplyr::mutate(month = format(date, "%m"))

boxplot(mean~month, data = months2, main = spName2, xlab = "Month", ylab = "Avg. Light (lux)", outline = FALSE)  

```
```{r}
summary(finalData$mean)

summary(finalData2$mean)
```


Independent T-test
```{r}

pVal <- t.test(finalData$mean, finalData2$mean)$p.value

signif <- function(x){
  if(x > 0.05){
    print("No significant difference between individuals")
  }
  else(print(as.numeric(x)))
  
}

signif(pVal)
```




